<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="race">
	<typeAlias alias="RaceModelValue" type="com.mongolia.website.model.RaceModelValue" />
	<typeAlias alias="RaceScoreLogValue"
		type="com.mongolia.website.model.RaceScoreLogValue" />
	<typeAlias alias="RaceDocumentValue"
		type="com.mongolia.website.model.RaceDocumentValue" />
	<typeAlias alias="UserValue" type="com.mongolia.website.model.UserValue" />
	<select id="getRaceModel" parameterClass="java.util.Map"
		resultClass="RaceModelValue">
		select * from racemodel
		<dynamic prepend="where">
			<isNotNull prepend="and" property="raceid">
				raceid=#raceid#
			</isNotNull>
			<isNotNull prepend="and" property="inactive">
				inactive=#inactive#
			</isNotNull>
		</dynamic>
	</select>
	<select id="getRaceDocumentValue" parameterClass="java.util.Map"
		resultClass="RaceDocumentValue">
		select * from racedocument
		<dynamic prepend="where">
			<isNotNull prepend="and" property="raceid">
				raceid=#raceid#
			</isNotNull>
			<isNotNull prepend="and" property="docid">
				docid=#docid#
			</isNotNull>
			<isNotNull prepend="and" property="inactive">
				inactive=#inactive#
			</isNotNull>
			<isNotNull prepend="and" property="joinuserid">
				joinuserid=#joinuserid#
			</isNotNull>
			<isNotNull prepend="and" property="round">
				raceround=#round#
			</isNotNull>
		</dynamic>
	</select>
	<select id="getRaceScoreLogValue" parameterClass="java.util.Map"
		resultClass="RaceScoreLogValue">
		select * from racescorelog
		<dynamic prepend="where">
			<isNotNull prepend="and" property="raceid">
				raceid=#raceid#
			</isNotNull>
			<isNotNull prepend="and" property="docid">
				docid=#docid#
			</isNotNull>
			<isNotNull prepend="and" property="usertype">
				usertype=#usertype#
			</isNotNull>
			<isNotNull prepend="and" property="scoreuserid">
				scoreuserid=#scoreuserid#
			</isNotNull>
			<isNotNull prepend="and" property="round">
				round=#round#
			</isNotNull>
		</dynamic>
	</select>
	<insert id="addRaceDocumentValue" parameterClass="RaceDocumentValue">
		insert into
		RaceDocument(
		raceid,
		docid,
		joindate,
		nettotalscore,
		netaveragescore,
		spetotalscore,
		speaveragescore,
		finalscore,
		joinuserid,
		jointype,
		raceround
		) values(
		#raceid#,
		#docid#,
		#joindate#,
		#nettotalscore#,
		#netaveragescore#,
		#spetotalscore#,
		#speaveragescore#,
		#finalscore#,
		#joinuserid#,
		#jointype#,
		#raceround#
		)
	</insert>
	<delete id="delRaceDocumentValue" parameterClass="java.util.Map">
		delete from
		racedocument where raceid=#raceid# and
		docid=#docid# and
		joinuserid=#joinuserid#
	</delete>
	<insert id="addRaceScoreLogValue" parameterClass="RaceScoreLogValue">
		insert into
		RaceScoreLog(
		raceid,
		docid,
		scoredate,
		scoreuserid,
		usertype,
		score,
		round
		) values(
		#raceid#,
		#docid#,
		#scoredate#,
		#scoreuserid#,
		#usertype#,
		#score#,
		#round#
		)
	</insert>
	<select id="getRaceUserList" parameterClass="java.util.Map"
		resultClass="UserValue">
		select distinct b.* from racedocument a,user b where
		a.joinuserid=b.userid
		<dynamic prepend="and">
			<isNotNull prepend="and" property="raceid">
				a.raceid=#raceid#
			</isNotNull>
		</dynamic>
	</select>
	<select id="getRaceSumValue" parameterClass="java.util.Map"
		resultClass="RaceDocumentValue">
		select sum(a.score) nettotalscore,count(1) as
		netscorecount,sum(a.score)/count(1) as netaveragescore,usertype as raceround from
		racescorelog a where a.raceid=#raceid# and a.docid=#docid# and round=#round#
		GROUP BY a.raceid,a.docid,a.usertype
	</select>
</sqlMap>